import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as a,b as e}from"./app-BUegsOj5.js";const o={},t=e(`<h2 id="前提准备" tabindex="-1"><a class="header-anchor" href="#前提准备"><span>前提准备</span></a></h2><p>操作系统</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token punctuation">(</span><span class="token function">Get-CimInstance</span> <span class="token operator">-</span>ClassName Win32_OperatingSystem<span class="token punctuation">)</span><span class="token punctuation">.</span>Caption
Microsoft Windows Server 2022 Standard Evaluation
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>系统命名</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Rename-Computer</span> <span class="token operator">-</span>NewName BJDC02 <span class="token operator">-</span>Restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>IP地址</p><div class="language-markdown line-numbers-mode" data-ext="md" data-title="md"><pre class="language-markdown"><code>IP地址：10.10.10.11
子网掩码：255.255.255.0
默认网关：10.10.10.1
DNS服务器：10.10.10.10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="加域" tabindex="-1"><a class="header-anchor" href="#加域"><span>加域</span></a></h2><p>ping</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>ping minicontoso<span class="token punctuation">.</span>com

Pinging minicontoso<span class="token punctuation">.</span>com <span class="token punctuation">[</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">]</span> with 32 bytes of <span class="token keyword">data</span>:
Reply <span class="token keyword">from</span> 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10: bytes=32 time&lt;1ms TTL=128
Reply <span class="token keyword">from</span> 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10: bytes=32 time=1ms TTL=128
Reply <span class="token keyword">from</span> 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10: bytes=32 time=2ms TTL=128
Reply <span class="token keyword">from</span> 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10: bytes=32 time=6ms TTL=128

Ping statistics <span class="token keyword">for</span> 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10:
    Packets: Sent = 4<span class="token punctuation">,</span> Received = 4<span class="token punctuation">,</span> Lost = 0 <span class="token punctuation">(</span>0% loss<span class="token punctuation">)</span><span class="token punctuation">,</span>
Approximate round trip times in milli-seconds:
    Minimum = 0ms<span class="token punctuation">,</span> Maximum = 6ms<span class="token punctuation">,</span> Average = 2ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加域</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Add-Computer</span> <span class="token operator">-</span>DomainName minicontoso<span class="token punctuation">.</span>com <span class="token operator">-</span>Credential minicontoso\\administrator <span class="token operator">-</span>Restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="安装活动目录域服务" tabindex="-1"><a class="header-anchor" href="#安装活动目录域服务"><span>安装活动目录域服务</span></a></h2><p>whoami</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>whoami
minicontoso\\administrator
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>安装活动目录域服务</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Install-WindowsFeature</span> AD-Domain-Services <span class="token operator">-</span>IncludeManagementTools

Success Restart Needed <span class="token keyword">Exit</span> Code      Feature Result                               
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>                               
True    No             Success        <span class="token punctuation">{</span>Active Directory Domain Services<span class="token punctuation">,</span> <span class="token function">Group</span> P<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="提升为域控制器" tabindex="-1"><a class="header-anchor" href="#提升为域控制器"><span>提升为域控制器</span></a></h2><p>Install-ADDSDomainController -DomainName minicontoso.com -InstallDns -WhatIf</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Install-ADDSDomainController</span> <span class="token operator">-</span>DomainName minicontoso<span class="token punctuation">.</span>com <span class="token operator">-</span>InstallDns <span class="token operator">-</span>WhatIf

SafeModeAdministratorPassword: <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
Confirm SafeModeAdministratorPassword: <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
What <span class="token keyword">if</span>: Create a new Active Directory domain controller in the domain <span class="token string">&#39;minicontoso.com&#39;</span><span class="token punctuation">.</span>
Configure this server as an additional Active Directory domain controller <span class="token keyword">for</span> the domain <span class="token string">&quot;minicontoso.com&quot;</span><span class="token punctuation">.</span>

Site Name:

Additional Options:

  <span class="token function">Read-only</span> domain controller: No

  Global catalog: Yes

  DNS Server: Yes

  Update DNS Delegation: No

Source domain controller: any writable domain controller

Database folder: C:\\Windows\\NTDS

Log file folder: C:\\Windows\\NTDS

SYSVOL folder: C:\\Windows\\SYSVOL

The DNS Server service will be configured on this computer<span class="token punctuation">.</span>

This computer will be configured to use this DNS server as its preferred DNS server<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Install-ADDSDomainController -DomainName minicontoso.com -InstallDns</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Install-ADDSDomainController</span> <span class="token operator">-</span>DomainName minicontoso<span class="token punctuation">.</span>com <span class="token operator">-</span>InstallDns

SafeModeAdministratorPassword: <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
Confirm SafeModeAdministratorPassword: <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

The target server will be configured as a domain controller and restarted when this operation is complete<span class="token punctuation">.</span>
<span class="token keyword">Do</span> you want to <span class="token keyword">continue</span> with this operation?
<span class="token namespace">[Y]</span> Yes  <span class="token namespace">[A]</span> Yes to All  <span class="token namespace">[N]</span> No  <span class="token namespace">[L]</span> No to All  <span class="token namespace">[S]</span> Suspend  <span class="token punctuation">[</span>?<span class="token punctuation">]</span> Help <span class="token punctuation">(</span>default is <span class="token string">&quot;Y&quot;</span><span class="token punctuation">)</span>: Y
WARNING: Windows Server 2022 domain controllers have a default <span class="token keyword">for</span> the security setting named <span class="token string">&quot;Allow cryptography algorithms compatible with Windows NT 4.0&quot;</span> that prevents weaker cryptography algorithms when establishing security channel sessions<span class="token punctuation">.</span>

<span class="token keyword">For</span> more information about this setting<span class="token punctuation">,</span> see Knowledge Base article 942564 <span class="token punctuation">(</span>http:<span class="token operator">/</span><span class="token operator">/</span>go<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>com/fwlink/?LinkId=104751<span class="token punctuation">)</span><span class="token punctuation">.</span>

WARNING: A delegation <span class="token keyword">for</span> this DNS server cannot be created because the authoritative parent zone cannot be found or it does not run Windows DNS server<span class="token punctuation">.</span> <span class="token keyword">If</span> you are integrating with an existing DNS infrastructure<span class="token punctuation">,</span> you should manually create a delegation to this DNS server in the parent zone to ensure reliable name resolution <span class="token keyword">from</span> outside the domain <span class="token string">&quot;minicontoso.com&quot;</span><span class="token punctuation">.</span> Otherwise<span class="token punctuation">,</span> no action is required<span class="token punctuation">.</span>

WARNING: Windows Server 2022 domain controllers have a default <span class="token keyword">for</span> the security setting named <span class="token string">&quot;Allow cryptography algorithms compatible with Windows NT 4.0&quot;</span> that prevents weaker cryptography algorithms when establishing security channel sessions<span class="token punctuation">.</span>

<span class="token keyword">For</span> more information about this setting<span class="token punctuation">,</span> see Knowledge Base article 942564 <span class="token punctuation">(</span>http:<span class="token operator">/</span><span class="token operator">/</span>go<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>com/fwlink/?LinkId=104751<span class="token punctuation">)</span><span class="token punctuation">.</span>

WARNING: A delegation <span class="token keyword">for</span> this DNS server cannot be created because the authoritative parent zone cannot be found or it does not run Windows DNS server<span class="token punctuation">.</span> <span class="token keyword">If</span> you are integrating with an existing DNS infrastructure<span class="token punctuation">,</span> you should manually create a delegation to this DNS server in the parent zone to ensure reliable name resolution <span class="token keyword">from</span> outside the domain <span class="token string">&quot;minicontoso.com&quot;</span><span class="token punctuation">.</span> Otherwise<span class="token punctuation">,</span> no action is required<span class="token punctuation">.</span>

Message                          Context           RebootRequired  Status
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>                          <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>           <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Operation completed successfully DCPromo<span class="token punctuation">.</span>General<span class="token punctuation">.</span>3          False Success
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="检查配置" tabindex="-1"><a class="header-anchor" href="#检查配置"><span>检查配置</span></a></h2><p>whoami</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>whoami
minicontoso\\administrator
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Get-ADDomainController -Filter * | Select-Object Forest, Domain, Site, HostName, OperationMasterRoles | Format-Table</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Get-ADDomainController</span> <span class="token operator">-</span><span class="token keyword">Filter</span> <span class="token operator">*</span> <span class="token punctuation">|</span> <span class="token function">Select-Object</span> Forest<span class="token punctuation">,</span> Domain<span class="token punctuation">,</span> Site<span class="token punctuation">,</span> HostName<span class="token punctuation">,</span> OperationMasterRoles <span class="token punctuation">|</span> <span class="token function">Format-Table</span>

Forest          Domain          Site                    HostName               OperationMasterRoles
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>          <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>          <span class="token operator">--</span><span class="token operator">--</span>                    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>               <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
minicontoso<span class="token punctuation">.</span>com minicontoso<span class="token punctuation">.</span>com Default-First-Site-Name BJDC01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com <span class="token punctuation">{</span>SchemaMaster<span class="token punctuation">,</span> DomainNamingMaster<span class="token punctuation">,</span> PDCEmulator<span class="token punctuation">,</span> RIDMaster<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
minicontoso<span class="token punctuation">.</span>com minicontoso<span class="token punctuation">.</span>com Default-First-Site-Name BJDC02<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>netdom query fsmo</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>netdom query fsmo

Schema master               BJDC01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com
Domain naming master        BJDC01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com
PDC                         BJDC01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com
RID pool manager            BJDC01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com
Infrastructure master       BJDC01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,29),p=[t];function i(l,r){return a(),s("div",null,p)}const u=n(o,[["render",i],["__file","bjdc02.html.vue"]]),m=JSON.parse('{"path":"/adds/bjdc02.html","title":"安装备域控服务器","lang":"zh-CN","frontmatter":{"title":"安装备域控服务器","icon":"gears","order":3,"category":["活动目录"],"tag":["活动目录","域控制器","备份域控"],"description":"前提准备 操作系统 系统命名 IP地址 加域 ping 加域 安装活动目录域服务 whoami 安装活动目录域服务 提升为域控制器 Install-ADDSDomainController -DomainName minicontoso.com -InstallDns -WhatIf Install-ADDSDomainController -Doma...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/adds/bjdc02.html"}],["meta",{"property":"og:site_name","content":"minicontoso"}],["meta",{"property":"og:title","content":"安装备域控服务器"}],["meta",{"property":"og:description","content":"前提准备 操作系统 系统命名 IP地址 加域 ping 加域 安装活动目录域服务 whoami 安装活动目录域服务 提升为域控制器 Install-ADDSDomainController -DomainName minicontoso.com -InstallDns -WhatIf Install-ADDSDomainController -Doma..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"Echo"}],["meta",{"property":"article:tag","content":"活动目录"}],["meta",{"property":"article:tag","content":"域控制器"}],["meta",{"property":"article:tag","content":"备份域控"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"安装备域控服务器\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Echo\\",\\"url\\":\\"https://www.minicontoso.com\\"}]}"]]},"headers":[{"level":2,"title":"前提准备","slug":"前提准备","link":"#前提准备","children":[]},{"level":2,"title":"加域","slug":"加域","link":"#加域","children":[]},{"level":2,"title":"安装活动目录域服务","slug":"安装活动目录域服务","link":"#安装活动目录域服务","children":[]},{"level":2,"title":"提升为域控制器","slug":"提升为域控制器","link":"#提升为域控制器","children":[]},{"level":2,"title":"检查配置","slug":"检查配置","link":"#检查配置","children":[]}],"git":{},"readingTime":{"minutes":2.37,"words":710},"filePathRelative":"adds/bjdc02.md","autoDesc":true}');export{u as comp,m as data};

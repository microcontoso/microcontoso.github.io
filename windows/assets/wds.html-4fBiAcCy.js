import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as a,b as e}from"./app-BUegsOj5.js";const t="/assets/image/wds.png",p={},o=e(`<h2 id="前提准备" tabindex="-1"><a class="header-anchor" href="#前提准备"><span>前提准备</span></a></h2><p>操作系统</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token punctuation">(</span><span class="token function">Get-CimInstance</span> <span class="token operator">-</span>ClassName Win32_OperatingSystem<span class="token punctuation">)</span><span class="token punctuation">.</span>Caption
Microsoft Windows Server 2022 Standard Evaluation
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>系统命名</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Rename-Computer</span> <span class="token operator">-</span>NewName BJWDS01 <span class="token operator">-</span>Restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>IP地址</p><div class="language-markdown line-numbers-mode" data-ext="md" data-title="md"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 独立网络</span>
IP地址：10.10.20.20
子网掩码：255.255.255.0
默认网关：10.10.20.1
DNS服务器（首选）：10.10.10.10
DNS服务器（备选）：10.10.10.11
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加域</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Add-Computer</span> <span class="token operator">-</span>DomainName minicontoso<span class="token punctuation">.</span>com <span class="token operator">-</span>Credential minicontoso\\administrator <span class="token operator">-</span>Restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="安装wds服务" tabindex="-1"><a class="header-anchor" href="#安装wds服务"><span>安装WDS服务</span></a></h2><p>WDS: Windows Deployment Service</p><p>whoami</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>whoami
minicontoso\\administrator
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Get-WindowsFeature wds-deployment</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Get-WindowsFeature</span> wds-deployment

Display Name                                            Name                       Install State
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>                                            <span class="token operator">--</span><span class="token operator">--</span>                       <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
    <span class="token punctuation">[</span> <span class="token punctuation">]</span> Deployment Server                               WDS-Deployment                 Available
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装WDS服务</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Install-WindowsFeature</span> wds-deployment <span class="token operator">-</span>includemanagementtools

Success Restart Needed <span class="token keyword">Exit</span> Code      Feature Result                               
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>                               
True    No             Success        <span class="token punctuation">{</span>Remote Server Administration Tools<span class="token punctuation">,</span> Role <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="初始化wds服务" tabindex="-1"><a class="header-anchor" href="#初始化wds服务"><span>初始化WDS服务</span></a></h2><p>初始化WDS服务</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>wdsutil <span class="token operator">/</span><span class="token function">Initialize-Server</span> <span class="token operator">/</span>remInst:D:\\remoteInstall

Windows Deployment Services Management Utility <span class="token namespace">[Version 10.0.20348.1]</span>
© Microsoft Corporation<span class="token punctuation">.</span> All rights reserved<span class="token punctuation">.</span>

The command completed successfully<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认WDS不响应任何PXE请求，我们修改为响应任何PXE请求（已知和未知），以便于可以网络部署操作系统。</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>wdsutil <span class="token operator">/</span><span class="token function">Set-Server</span> <span class="token operator">/</span>AnswerClients:All

Windows Deployment Services Management Utility <span class="token namespace">[Version 10.0.20348.1]</span>
© Microsoft Corporation<span class="token punctuation">.</span> All rights reserved<span class="token punctuation">.</span>

The command completed successfully<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="添加启动镜像" tabindex="-1"><a class="header-anchor" href="#添加启动镜像"><span>添加启动镜像</span></a></h2><p>挂载Windows10安装镜像</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">ls</span> G:\\sources\\<span class="token operator">*</span><span class="token punctuation">.</span>WIM

    Directory: g:\\sources

Mode                 LastWriteTime         Length Name
<span class="token operator">--</span><span class="token operator">--</span>                 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span>r-<span class="token operator">--</span>         5/10/2020  11:14 PM      563182245 boot<span class="token punctuation">.</span>wim
<span class="token operator">--</span>r-<span class="token operator">--</span>         5/10/2020  11:16 PM     4165292682 install<span class="token punctuation">.</span>wim
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加启动镜像boot.wim</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Import-WdsBootImage</span> <span class="token operator">-</span>Path <span class="token string">&quot;G:\\sources\\boot.wim&quot;</span>

Architecture            : X64
CreationTime            : 12/7/2019 5:27:10 AM
DefaultLanguage         : zh-CN
Description             : Microsoft Windows Setup <span class="token punctuation">(</span>x64<span class="token punctuation">)</span>
DisplayOrder            : 500000
Enabled                 : True
FileName                : boot<span class="token punctuation">.</span>wim
Hal                     : 
Id                      : <span class="token punctuation">{</span>E7353765-A6C0-4BEE-B905-5DBD81694E66<span class="token punctuation">}</span>
Index                   : 2
Languages               : <span class="token punctuation">{</span>zh-CN<span class="token punctuation">}</span>
LastModificationTime    : 6/15/2024 11:32:26 PM
Name                    : Microsoft Windows Setup <span class="token punctuation">(</span>x64<span class="token punctuation">)</span>
PriorityDefaulted       : True
ProductFamily           : 
ProductName             : Microsoft® Windows® Operating System
ServicePackLevel        : 0
Size                    : 2077454547
SupportsDriverInjection : True
SystemRoot              : WINDOWS
Version                 : 10<span class="token punctuation">.</span>0<span class="token punctuation">.</span>19041
PSComputerName          : 
ImageName               : Microsoft Windows Setup <span class="token punctuation">(</span>x64<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="添加安装镜像" tabindex="-1"><a class="header-anchor" href="#添加安装镜像"><span>添加安装镜像</span></a></h2><p>查询安装镜像</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Get-WindowsImage</span> <span class="token operator">-</span>imagePath <span class="token string">&quot;G:\\sources\\install.wim&quot;</span> <span class="token punctuation">|</span> <span class="token function">select</span> ImageName

ImageName       
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>       
Windows 10 企业评估版
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有的可能会有多个，例如：Windows 10 专业版 / Windows 10 教育版等。</p><p>创建镜像组</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">New-WdsInstallImageGroup</span> <span class="token operator">-</span>Name <span class="token string">&quot;Windows10&quot;</span>

Name           : Windows10
ImageFormat    : Empty
Security       : O:BAG:DUD:<span class="token punctuation">(</span>A<span class="token punctuation">;</span>OICI<span class="token punctuation">;</span>FA<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>SY<span class="token punctuation">)</span><span class="token punctuation">(</span>A<span class="token punctuation">;</span>OICI<span class="token punctuation">;</span>FA<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>BA<span class="token punctuation">)</span><span class="token punctuation">(</span>A<span class="token punctuation">;</span>OICI<span class="token punctuation">;</span>0x1200a9<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>AU<span class="token punctuation">)</span><span class="token punctuation">(</span>A<span class="token punctuation">;</span>OICI<span class="token punctuation">;</span>FA<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>S-1-5-80-1688844526-3235337491-1375791646-891369040-3692469510<span class="token punctuation">)</span>
PSComputerName : 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加安装镜像install.wim</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token function">Import-WdsInstallImage</span> <span class="token operator">-</span>ImageGroup <span class="token string">&quot;Windows10&quot;</span> <span class="token operator">-</span>Path <span class="token string">&quot;G:\\sources\\install.wim&quot;</span> <span class="token operator">-</span>ImageName <span class="token string">&quot;windows 10 enterprise evaluation&quot;</span>

Architecture            : X64
CreationTime            : 5/10/2020 10:49:57 PM
DefaultLanguage         : zh-CN
Description             : Windows 10 Enterprise Evaluation
DisplayOrder            : 500000
Enabled                 : True
FileName                : install<span class="token punctuation">.</span>wim
Hal                     : 
Id                      : <span class="token punctuation">{</span>CA8C309D-94DC-4E2B-B5A7-D7F317FD4D4C<span class="token punctuation">}</span>
Index                   : 1
Languages               : <span class="token punctuation">{</span>zh-CN<span class="token punctuation">}</span>
LastModificationTime    : 6/15/2024 11:43:26 PM
Name                    : Windows 10 Enterprise Evaluation
PriorityDefaulted       : True
ProductFamily           : Terminal Server
ProductName             : Microsoft® Windows® Operating System
ServicePackLevel        : 0
Size                    : 14916711499
SupportsDriverInjection : False
SystemRoot              : WINDOWS
Version                 : 10<span class="token punctuation">.</span>0<span class="token punctuation">.</span>19041
Compression             : Lzx
DependentFiles          : <span class="token punctuation">{</span>\\\\BJWDS01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com\\REMINST\\Images\\Windows10\\install<span class="token punctuation">.</span>wim<span class="token punctuation">,</span> \\\\BJWDS01<span class="token punctuation">.</span>minicontoso<span class="token punctuation">.</span>com\\REMINST\\Images\\Windows10\\res<span class="token punctuation">.</span>rwm<span class="token punctuation">}</span>
Format                  : Wim
ImageGroup              : Windows10
PartitionStyle          : Unknown
Security                : O:BAG:SYD:<span class="token punctuation">(</span>A<span class="token punctuation">;</span><span class="token punctuation">;</span>FA<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>SY<span class="token punctuation">)</span><span class="token punctuation">(</span>A<span class="token punctuation">;</span><span class="token punctuation">;</span>FA<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>BA<span class="token punctuation">)</span><span class="token punctuation">(</span>A<span class="token punctuation">;</span><span class="token punctuation">;</span>0x1200a9<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>AU<span class="token punctuation">)</span><span class="token punctuation">(</span>A<span class="token punctuation">;</span><span class="token punctuation">;</span>FA<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>S-1-5-80-1688844526-3235337491-1375791646-891369040-3692469510<span class="token punctuation">)</span>
Staged                  : True
UnattendFilePresent     : False
PSComputerName          : 
ImageName               : Windows 10 Enterprise Evaluation
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="dhcp支持" tabindex="-1"><a class="header-anchor" href="#dhcp支持"><span>DHCP支持</span></a></h2><p>确保DHCP类型支持BOOTP</p><p>-Type</p><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> DHCP</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> BOOTP</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> Both</label></li></ul><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token punctuation">(</span>Get-DhcpServerv4Scope <span class="token operator">-</span>ScopeId 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>20<span class="token punctuation">.</span>0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Type</span>
Both
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>配置66选项，指向WDS服务器</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>Get-DhcpServerv4OptionValue <span class="token operator">-</span>ScopeId 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>20<span class="token punctuation">.</span>0 <span class="token punctuation">|</span> <span class="token function">Format-Table</span> <span class="token operator">-</span>AutoSize

OptionId Name                  <span class="token function">Type</span>        Value                      VendorClass UserClass PolicyName
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span>                  <span class="token operator">--</span><span class="token operator">--</span>        <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>                      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
51       Lease                 DWord       <span class="token punctuation">{</span>86400<span class="token punctuation">}</span>
3        Router                IPv4Address <span class="token punctuation">{</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>20<span class="token punctuation">.</span>1<span class="token punctuation">}</span>
6        DNS Servers           IPv4Address <span class="token punctuation">{</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">,</span> 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>11<span class="token punctuation">}</span>
66       Boot Server Host Name String      <span class="token punctuation">{</span>10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>20<span class="token punctuation">.</span>20<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>网络启动</p><img src="`+t+'">',44),l=[o];function i(c,r){return a(),s("div",null,l)}const v=n(p,[["render",i],["__file","wds.html.vue"]]),m=JSON.parse('{"path":"/osd/wds.html","title":"WDS服务","lang":"zh-CN","frontmatter":{"title":"WDS服务","icon":"clone","order":1,"category":["osd"],"tag":["osd"],"description":"前提准备 操作系统 系统命名 IP地址 加域 安装WDS服务 WDS: Windows Deployment Service whoami Get-WindowsFeature wds-deployment 安装WDS服务 初始化WDS服务 初始化WDS服务 默认WDS不响应任何PXE请求，我们修改为响应任何PXE请求（已知和未知），以便于可以网络部署...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/osd/wds.html"}],["meta",{"property":"og:site_name","content":"minicontoso"}],["meta",{"property":"og:title","content":"WDS服务"}],["meta",{"property":"og:description","content":"前提准备 操作系统 系统命名 IP地址 加域 安装WDS服务 WDS: Windows Deployment Service whoami Get-WindowsFeature wds-deployment 安装WDS服务 初始化WDS服务 初始化WDS服务 默认WDS不响应任何PXE请求，我们修改为响应任何PXE请求（已知和未知），以便于可以网络部署..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"Echo"}],["meta",{"property":"article:tag","content":"osd"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"WDS服务\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Echo\\",\\"url\\":\\"https://www.minicontoso.com\\"}]}"]]},"headers":[{"level":2,"title":"前提准备","slug":"前提准备","link":"#前提准备","children":[]},{"level":2,"title":"安装WDS服务","slug":"安装wds服务","link":"#安装wds服务","children":[]},{"level":2,"title":"初始化WDS服务","slug":"初始化wds服务","link":"#初始化wds服务","children":[]},{"level":2,"title":"添加启动镜像","slug":"添加启动镜像","link":"#添加启动镜像","children":[]},{"level":2,"title":"添加安装镜像","slug":"添加安装镜像","link":"#添加安装镜像","children":[]},{"level":2,"title":"DHCP支持","slug":"dhcp支持","link":"#dhcp支持","children":[]}],"git":{},"readingTime":{"minutes":2.27,"words":680},"filePathRelative":"osd/wds.md","autoDesc":true}');export{v as comp,m as data};
